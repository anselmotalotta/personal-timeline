services:
  frontend:
    build:
      context: .
      dockerfile: src/frontend/Dockerfile
    ports:
      - "52692:3000"
    volumes:
      # Only mount data directory, no source code mounting to avoid module conflicts
      - ../MyData:/app/MyData
    environment:
      - REACT_APP_BACKEND_URL=http://backend:8000
      - REACT_APP_QA_URL=http://qa:8085
      - BROWSER=none
      - WDS_SOCKET_PORT=52692
    depends_on:
      - backend
      - qa

  qa:
    build:
      context: .
      dockerfile: Dockerfile.qa.simple
    ports:
      - "57485:8085"
    volumes:
      - ../MyData:/app/MyData
      - ./src/qa:/app/src/qa
    environment:
      - APP_DATA_DIR=/app/MyData/app_data
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
    command: python -m src.qa.server
    depends_on:
      - backend

  backend:
    build:
      context: .
      dockerfile: Dockerfile.simple
    ports:
      - "8000:8000"
    volumes:
      - ../MyData:/app/MyData
      - ./src:/app/src
    environment:
      - APP_DATA_DIR=/app/MyData/app_data
      - ingest_new_data=True
      - incremental_geo_enrich=False
      - incremental_image_enrich=False
      - incremental_export=True
      - enriched_data_to_json=True
    command: bash src/ingest/ingestion_startup.sh
