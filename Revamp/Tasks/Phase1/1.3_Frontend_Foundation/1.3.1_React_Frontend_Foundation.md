# Epic 1.3.1: React Frontend Foundation

**Phase**: 1 - Foundation & Core Infrastructure  
**Epic**: 1.3.1 React Frontend Foundation  
**Duration**: 2 weeks  
**Team Size**: 2 developers (Frontend Lead + UI Developer)  

---

## Goal

Build a modern, scalable React frontend foundation with TypeScript, state management, routing, authentication, and a comprehensive design system - optimized for personal timeline exploration with responsive design, accessibility, and performance.

---

## Scope Assumptions

### Technology Stack
- **Framework**: React 18+ with TypeScript
- **Build Tool**: Vite for fast development and optimized builds
- **State Management**: Zustand for global state, React Query for server state
- **Routing**: React Router v6 with nested routes and code splitting
- **Styling**: Tailwind CSS with custom design system
- **UI Components**: Headless UI + custom components

### Architecture Principles
- **Component-Driven**: Atomic design methodology
- **Type Safety**: Comprehensive TypeScript coverage
- **Performance**: Code splitting, lazy loading, optimized bundles
- **Accessibility**: WCAG 2.1 AA compliance
- **Responsive**: Mobile-first design approach
- **Testing**: Jest + Testing Library for unit/integration tests

### Core Features
- **Authentication**: JWT-based auth with automatic token refresh
- **Navigation**: Intuitive navigation with breadcrumbs and search
- **Error Handling**: Comprehensive error boundaries and user feedback
- **Loading States**: Skeleton screens and progressive loading
- **Offline Support**: Basic offline functionality with service workers

---

## Success Criteria

- [ ] **Development Experience**: Hot reload < 1s, TypeScript errors caught at build time
- [ ] **Performance**: Lighthouse score > 90, First Contentful Paint < 2s
- [ ] **Accessibility**: WCAG 2.1 AA compliance, keyboard navigation support
- [ ] **Responsive Design**: Works seamlessly on mobile, tablet, and desktop
- [ ] **Type Safety**: 100% TypeScript coverage, no `any` types in production code
- [ ] **Testing**: >80% test coverage for components and utilities
- [ ] **Bundle Size**: Initial bundle < 500KB gzipped
- [ ] **Error Handling**: Graceful error recovery and user feedback

---

## Non-Goals

- Server-side rendering (SSR) or static site generation (SSG)
- Progressive Web App (PWA) features beyond basic offline support
- Advanced animations or micro-interactions (basic transitions only)
- Multi-language internationalization (English only for MVP)
- Advanced accessibility features beyond WCAG 2.1 AA

---

## Risks & Mitigations

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Bundle size growth | Medium | High | Code splitting, tree shaking, bundle analysis |
| TypeScript complexity | Low | Medium | Gradual adoption, team training, clear guidelines |
| State management complexity | Medium | Medium | Simple state structure, clear data flow patterns |
| Performance on mobile | High | Medium | Performance budgets, mobile-first testing |
| Accessibility compliance | Medium | Low | Automated testing, manual audits, expert review |

---

## Detailed Tasks

### Task 1: Project Setup & Build Configuration

#### 1.1 Vite Configuration & Project Structure

**Project Structure:**
```
apps/web/
├── public/
│   ├── favicon.ico
│   ├── manifest.json
│   └── robots.txt
├── src/
│   ├── components/
│   │   ├── ui/           # Base UI components
│   │   ├── layout/       # Layout components
│   │   ├── forms/        # Form components
│   │   └── features/     # Feature-specific components
│   ├── pages/            # Page components
│   ├── hooks/            # Custom React hooks
│   ├── stores/           # Zustand stores
│   ├── services/         # API services
│   ├── utils/            # Utility functions
│   ├── types/            # TypeScript type definitions
│   ├── styles/           # Global styles and Tailwind config
│   ├── assets/           # Static assets
│   └── App.tsx
├── tests/
│   ├── __mocks__/
│   ├── setup.ts
│   └── utils.tsx
├── vite.config.ts
├── tailwind.config.js
├── tsconfig.json
├── package.json
└── README.md
```

**Vite Configuration (vite.config.ts):**
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import { resolve } from 'path'
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    react({
      // Enable React Fast Refresh
      fastRefresh: true,
      // Include .tsx files
      include: "**/*.{jsx,tsx}",
    }),
    // Bundle analyzer
    visualizer({
      filename: 'dist/stats.html',
      open: true,
      gzipSize: true,
    }),
  ],
  
  // Path resolution
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@components': resolve(__dirname, 'src/components'),
      '@pages': resolve(__dirname, 'src/pages'),
      '@hooks': resolve(__dirname, 'src/hooks'),
      '@stores': resolve(__dirname, 'src/stores'),
      '@services': resolve(__dirname, 'src/services'),
      '@utils': resolve(__dirname, 'src/utils'),
      '@types': resolve(__dirname, 'src/types'),
      '@assets': resolve(__dirname, 'src/assets'),
    },
  },
  
  // Development server
  server: {
    port: 3000,
    host: '0.0.0.0',
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        secure: false,
      },
    },
  },
  
  // Build configuration
  build: {
    target: 'es2020',
    outDir: 'dist',
    sourcemap: true,
    
    // Chunk splitting strategy
    rollupOptions: {
      output: {
        manualChunks: {
          // Vendor chunks
          'react-vendor': ['react', 'react-dom'],
          'router-vendor': ['react-router-dom'],
          'ui-vendor': ['@headlessui/react', '@heroicons/react'],
          
          // Feature chunks
          'auth': ['./src/pages/auth', './src/components/auth'],
          'timeline': ['./src/pages/timeline', './src/components/timeline'],
          'stories': ['./src/pages/stories', './src/components/stories'],
        },
      },
    },
    
    // Performance budgets
    chunkSizeWarningLimit: 1000,
  },
  
  // Optimization
  optimizeDeps: {
    include: [
      'react',
      'react-dom',
      'react-router-dom',
      '@headlessui/react',
      '@heroicons/react/24/outline',
      '@heroicons/react/24/solid',
    ],
  },
  
  // Environment variables
  define: {
    __APP_VERSION__: JSON.stringify(process.env.npm_package_version),
    __BUILD_TIME__: JSON.stringify(new Date().toISOString()),
  },
})
```

**TypeScript Configuration (tsconfig.json):**
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noImplicitReturns": true,
    "noImplicitOverride": true,
    "exactOptionalPropertyTypes": true,

    /* Path mapping */
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@pages/*": ["src/pages/*"],
      "@hooks/*": ["src/hooks/*"],
      "@stores/*": ["src/stores/*"],
      "@services/*": ["src/services/*"],
      "@utils/*": ["src/utils/*"],
      "@types/*": ["src/types/*"],
      "@assets/*": ["src/assets/*"]
    }
  },
  "include": ["src", "tests"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

**Package.json Dependencies:**
```json
{
  "name": "personal-timeline-web",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint . --ext ts,tsx --fix",
    "type-check": "tsc --noEmit",
    "format": "prettier --write \"src/**/*.{ts,tsx,js,jsx,json,css,md}\"",
    "analyze": "npm run build && npx vite-bundle-analyzer"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.8.0",
    "zustand": "^4.3.0",
    "@tanstack/react-query": "^4.24.0",
    "@headlessui/react": "^1.7.0",
    "@heroicons/react": "^2.0.0",
    "clsx": "^1.2.0",
    "date-fns": "^2.29.0",
    "framer-motion": "^10.0.0",
    "react-hook-form": "^7.43.0",
    "react-hot-toast": "^2.4.0",
    "react-intersection-observer": "^9.4.0",
    "react-virtual": "^2.10.0",
    "zod": "^3.20.0"
  },
  "devDependencies": {
    "@types/react": "^18.0.0",
    "@types/react-dom": "^18.0.0",
    "@typescript-eslint/eslint-plugin": "^5.52.0",
    "@typescript-eslint/parser": "^5.52.0",
    "@vitejs/plugin-react": "^3.1.0",
    "@vitest/ui": "^0.28.0",
    "autoprefixer": "^10.4.0",
    "eslint": "^8.34.0",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.3.4",
    "eslint-plugin-jsx-a11y": "^6.7.0",
    "jsdom": "^21.1.0",
    "postcss": "^8.4.0",
    "prettier": "^2.8.0",
    "tailwindcss": "^3.2.0",
    "typescript": "^4.9.0",
    "vite": "^4.1.0",
    "vitest": "^0.28.0",
    "rollup-plugin-visualizer": "^5.9.0"
  }
}
```

**Deliverables:**
- [ ] Complete Vite configuration with optimization
- [ ] TypeScript setup with strict type checking
- [ ] Project structure following best practices
- [ ] Development and build scripts
- [ ] Bundle analysis and performance monitoring

#### 1.2 ESLint & Prettier Configuration

**ESLint Configuration (.eslintrc.cjs):**
```javascript
module.exports = {
  root: true,
  env: { browser: true, es2020: true },
  extends: [
    'eslint:recommended',
    '@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'plugin:react/recommended',
    'plugin:react/jsx-runtime',
    'plugin:jsx-a11y/recommended',
  ],
  ignorePatterns: ['dist', '.eslintrc.cjs'],
  parser: '@typescript-eslint/parser',
  parserOptions: {
    ecmaVersion: 'latest',
    sourceType: 'module',
    ecmaFeatures: {
      jsx: true,
    },
  },
  plugins: ['react-refresh', '@typescript-eslint', 'jsx-a11y'],
  rules: {
    // React specific rules
    'react-refresh/only-export-components': [
      'warn',
      { allowConstantExport: true },
    ],
    'react/prop-types': 'off', // Using TypeScript for prop validation
    'react/react-in-jsx-scope': 'off', // Not needed with new JSX transform
    
    // TypeScript specific rules
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/prefer-const': 'error',
    '@typescript-eslint/no-non-null-assertion': 'warn',
    
    // General rules
    'no-console': ['warn', { allow: ['warn', 'error'] }],
    'no-debugger': 'error',
    'prefer-const': 'error',
    'no-var': 'error',
    
    // Accessibility rules
    'jsx-a11y/alt-text': 'error',
    'jsx-a11y/anchor-has-content': 'error',
    'jsx-a11y/anchor-is-valid': 'error',
    'jsx-a11y/click-events-have-key-events': 'error',
    'jsx-a11y/heading-has-content': 'error',
    'jsx-a11y/img-redundant-alt': 'error',
    'jsx-a11y/label-has-associated-control': 'error',
    'jsx-a11y/no-autofocus': 'warn',
    'jsx-a11y/no-redundant-roles': 'error',
  },
  settings: {
    react: {
      version: 'detect',
    },
  },
}
```

**Prettier Configuration (.prettierrc):**
```json
{
  "semi": false,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "bracketSameLine": false,
  "arrowParens": "avoid",
  "endOfLine": "lf",
  "quoteProps": "as-needed",
  "jsxSingleQuote": true,
  "plugins": ["prettier-plugin-tailwindcss"]
}
```

**Deliverables:**
- [ ] ESLint configuration with React, TypeScript, and accessibility rules
- [ ] Prettier configuration with consistent formatting
- [ ] Pre-commit hooks for code quality
- [ ] VS Code settings for optimal development experience

### Task 2: Design System & UI Components

#### 2.1 Tailwind CSS Configuration & Design Tokens

**Tailwind Configuration (tailwind.config.js):**
```javascript
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      // Color palette
      colors: {
        // Primary brand colors
        primary: {
          50: '#f0f9ff',
          100: '#e0f2fe',
          200: '#bae6fd',
          300: '#7dd3fc',
          400: '#38bdf8',
          500: '#0ea5e9',
          600: '#0284c7',
          700: '#0369a1',
          800: '#075985',
          900: '#0c4a6e',
          950: '#082f49',
        },
        
        // Secondary colors
        secondary: {
          50: '#fafaf9',
          100: '#f5f5f4',
          200: '#e7e5e4',
          300: '#d6d3d1',
          400: '#a8a29e',
          500: '#78716c',
          600: '#57534e',
          700: '#44403c',
          800: '#292524',
          900: '#1c1917',
          950: '#0c0a09',
        },
        
        // Semantic colors
        success: {
          50: '#f0fdf4',
          100: '#dcfce7',
          200: '#bbf7d0',
          300: '#86efac',
          400: '#4ade80',
          500: '#22c55e',
          600: '#16a34a',
          700: '#15803d',
          800: '#166534',
          900: '#14532d',
          950: '#052e16',
        },
        
        warning: {
          50: '#fffbeb',
          100: '#fef3c7',
          200: '#fde68a',
          300: '#fcd34d',
          400: '#fbbf24',
          500: '#f59e0b',
          600: '#d97706',
          700: '#b45309',
          800: '#92400e',
          900: '#78350f',
          950: '#451a03',
        },
        
        error: {
          50: '#fef2f2',
          100: '#fee2e2',
          200: '#fecaca',
          300: '#fca5a5',
          400: '#f87171',
          500: '#ef4444',
          600: '#dc2626',
          700: '#b91c1c',
          800: '#991b1b',
          900: '#7f1d1d',
          950: '#450a0a',
        },
      },
      
      // Typography
      fontFamily: {
        sans: [
          'Inter',
          'ui-sans-serif',
          'system-ui',
          '-apple-system',
          'BlinkMacSystemFont',
          'Segoe UI',
          'Roboto',
          'Helvetica Neue',
          'Arial',
          'Noto Sans',
          'sans-serif',
        ],
        mono: [
          'JetBrains Mono',
          'ui-monospace',
          'SFMono-Regular',
          'Menlo',
          'Monaco',
          'Consolas',
          'Liberation Mono',
          'Courier New',
          'monospace',
        ],
      },
      
      fontSize: {
        'xs': ['0.75rem', { lineHeight: '1rem' }],
        'sm': ['0.875rem', { lineHeight: '1.25rem' }],
        'base': ['1rem', { lineHeight: '1.5rem' }],
        'lg': ['1.125rem', { lineHeight: '1.75rem' }],
        'xl': ['1.25rem', { lineHeight: '1.75rem' }],
        '2xl': ['1.5rem', { lineHeight: '2rem' }],
        '3xl': ['1.875rem', { lineHeight: '2.25rem' }],
        '4xl': ['2.25rem', { lineHeight: '2.5rem' }],
        '5xl': ['3rem', { lineHeight: '1' }],
        '6xl': ['3.75rem', { lineHeight: '1' }],
        '7xl': ['4.5rem', { lineHeight: '1' }],
        '8xl': ['6rem', { lineHeight: '1' }],
        '9xl': ['8rem', { lineHeight: '1' }],
      },
      
      // Spacing
      spacing: {
        '18': '4.5rem',
        '88': '22rem',
        '128': '32rem',
      },
      
      // Border radius
      borderRadius: {
        'xl': '0.75rem',
        '2xl': '1rem',
        '3xl': '1.5rem',
      },
      
      // Box shadows
      boxShadow: {
        'soft': '0 2px 15px -3px rgba(0, 0, 0, 0.07), 0 10px 20px -2px rgba(0, 0, 0, 0.04)',
        'medium': '0 4px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
        'large': '0 10px 40px -10px rgba(0, 0, 0, 0.15), 0 20px 25px -5px rgba(0, 0, 0, 0.1)',
      },
      
      // Animation
      animation: {
        'fade-in': 'fadeIn 0.5s ease-in-out',
        'slide-up': 'slideUp 0.3s ease-out',
        'slide-down': 'slideDown 0.3s ease-out',
        'scale-in': 'scaleIn 0.2s ease-out',
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      },
      
      keyframes: {
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        slideUp: {
          '0%': { transform: 'translateY(10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        slideDown: {
          '0%': { transform: 'translateY(-10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        scaleIn: {
          '0%': { transform: 'scale(0.95)', opacity: '0' },
          '100%': { transform: 'scale(1)', opacity: '1' },
        },
      },
      
      // Breakpoints (custom)
      screens: {
        'xs': '475px',
        '3xl': '1680px',
      },
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography'),
    require('@tailwindcss/aspect-ratio'),
  ],
}
```

**Design System Utilities (src/utils/design-system.ts):**
```typescript
import { clsx, type ClassValue } from 'clsx'

/**
 * Utility function to merge class names
 */
export function cn(...inputs: ClassValue[]) {
  return clsx(inputs)
}

/**
 * Design system constants
 */
export const designSystem = {
  // Spacing scale
  spacing: {
    xs: '0.5rem',    // 8px
    sm: '0.75rem',   // 12px
    md: '1rem',      // 16px
    lg: '1.5rem',    // 24px
    xl: '2rem',      // 32px
    '2xl': '3rem',   // 48px
    '3xl': '4rem',   // 64px
  },
  
  // Border radius scale
  radius: {
    none: '0',
    sm: '0.125rem',  // 2px
    md: '0.375rem',  // 6px
    lg: '0.5rem',    // 8px
    xl: '0.75rem',   // 12px
    '2xl': '1rem',   // 16px
    full: '9999px',
  },
  
  // Typography scale
  typography: {
    sizes: {
      xs: 'text-xs',
      sm: 'text-sm',
      base: 'text-base',
      lg: 'text-lg',
      xl: 'text-xl',
      '2xl': 'text-2xl',
      '3xl': 'text-3xl',
      '4xl': 'text-4xl',
    },
    weights: {
      normal: 'font-normal',
      medium: 'font-medium',
      semibold: 'font-semibold',
      bold: 'font-bold',
    },
  },
  
  // Color variants
  colors: {
    primary: 'primary',
    secondary: 'secondary',
    success: 'success',
    warning: 'warning',
    error: 'error',
  },
  
  // Component sizes
  sizes: {
    sm: 'sm',
    md: 'md',
    lg: 'lg',
    xl: 'xl',
  },
} as const

/**
 * Component variant utilities
 */
export const variants = {
  button: {
    base: 'inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background',
    
    variants: {
      default: 'bg-primary-600 text-white hover:bg-primary-700',
      destructive: 'bg-error-600 text-white hover:bg-error-700',
      outline: 'border border-input hover:bg-accent hover:text-accent-foreground',
      secondary: 'bg-secondary-100 text-secondary-900 hover:bg-secondary-200',
      ghost: 'hover:bg-accent hover:text-accent-foreground',
      link: 'underline-offset-4 hover:underline text-primary-600',
    },
    
    sizes: {
      sm: 'h-9 px-3 text-sm',
      md: 'h-10 py-2 px-4',
      lg: 'h-11 px-8',
      xl: 'h-12 px-10 text-lg',
    },
  },
  
  input: {
    base: 'flex w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
    
    variants: {
      default: 'border-gray-300 focus:border-primary-500 focus:ring-primary-500',
      error: 'border-error-500 focus:border-error-500 focus:ring-error-500',
    },
    
    sizes: {
      sm: 'h-8 px-2 text-xs',
      md: 'h-10 px-3 text-sm',
      lg: 'h-12 px-4 text-base',
    },
  },
  
  card: {
    base: 'rounded-lg border bg-card text-card-foreground shadow-sm',
    
    variants: {
      default: 'border-gray-200 bg-white',
      elevated: 'border-gray-200 bg-white shadow-medium',
      outlined: 'border-2 border-gray-300 bg-white',
    },
    
    padding: {
      sm: 'p-4',
      md: 'p-6',
      lg: 'p-8',
    },
  },
} as const

/**
 * Responsive utilities
 */
export const responsive = {
  // Breakpoint utilities
  breakpoints: {
    xs: '(min-width: 475px)',
    sm: '(min-width: 640px)',
    md: '(min-width: 768px)',
    lg: '(min-width: 1024px)',
    xl: '(min-width: 1280px)',
    '2xl': '(min-width: 1536px)',
    '3xl': '(min-width: 1680px)',
  },
  
  // Container utilities
  container: {
    center: 'mx-auto',
    padding: 'px-4 sm:px-6 lg:px-8',
    maxWidth: 'max-w-7xl',
  },
  
  // Grid utilities
  grid: {
    cols1: 'grid-cols-1',
    cols2: 'grid-cols-1 sm:grid-cols-2',
    cols3: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
    cols4: 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4',
    cols6: 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6',
  },
} as const

/**
 * Animation utilities
 */
export const animations = {
  // Transition presets
  transitions: {
    fast: 'transition-all duration-150 ease-in-out',
    normal: 'transition-all duration-300 ease-in-out',
    slow: 'transition-all duration-500 ease-in-out',
  },
  
  // Transform utilities
  transforms: {
    scaleHover: 'hover:scale-105 transform transition-transform duration-200',
    slideUp: 'animate-slide-up',
    fadeIn: 'animate-fade-in',
  },
} as const
```

**Deliverables:**
- [ ] Comprehensive Tailwind CSS configuration
- [ ] Design system utilities and constants
- [ ] Component variant system
- [ ] Responsive design utilities
- [ ] Animation and transition presets

#### 2.2 Base UI Components

**Button Component (src/components/ui/Button.tsx):**
```typescript
import React from 'react'
import { Slot } from '@radix-ui/react-slot'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/utils/design-system'

const buttonVariants = cva(
  'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',
  {
    variants: {
      variant: {
        default: 'bg-primary-600 text-white hover:bg-primary-700',
        destructive: 'bg-error-600 text-white hover:bg-error-700',
        outline: 'border border-gray-300 bg-white hover:bg-gray-50 hover:text-gray-900',
        secondary: 'bg-secondary-100 text-secondary-900 hover:bg-secondary-200',
        ghost: 'hover:bg-gray-100 hover:text-gray-900',
        link: 'text-primary-600 underline-offset-4 hover:underline',
      },
      size: {
        sm: 'h-9 rounded-md px-3',
        md: 'h-10 px-4 py-2',
        lg: 'h-11 rounded-md px-8',
        xl: 'h-12 rounded-md px-10',
        icon: 'h-10 w-10',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
  loading?: boolean
  leftIcon?: React.ReactNode
  rightIcon?: React.ReactNode
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ 
    className, 
    variant, 
    size, 
    asChild = false, 
    loading = false,
    leftIcon,
    rightIcon,
    children,
    disabled,
    ...props 
  }, ref) => {
    const Comp = asChild ? Slot : 'button'
    
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        disabled={disabled || loading}
        {...props}
      >
        {loading && (
          <svg
            className="mr-2 h-4 w-4 animate-spin"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              className="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              strokeWidth="4"
            />
            <path
              className="opacity-75"
              fill="currentColor"
              d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            />
          </svg>
        )}
        {!loading && leftIcon && (
          <span className="mr-2">{leftIcon}</span>
        )}
        {children}
        {!loading && rightIcon && (
          <span className="ml-2">{rightIcon}</span>
        )}
      </Comp>
    )
  }
)

Button.displayName = 'Button'

export { Button, buttonVariants }
```

**Input Component (src/components/ui/Input.tsx):**
```typescript
import React from 'react'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/utils/design-system'

const inputVariants = cva(
  'flex w-full rounded-md border bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',
  {
    variants: {
      variant: {
        default: 'border-gray-300 focus-visible:ring-primary-500',
        error: 'border-error-500 focus-visible:ring-error-500',
      },
      size: {
        sm: 'h-8 px-2 text-xs',
        md: 'h-10 px-3 text-sm',
        lg: 'h-12 px-4 text-base',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'md',
    },
  }
)

export interface InputProps
  extends React.InputHTMLAttributes<HTMLInputElement>,
    VariantProps<typeof inputVariants> {
  label?: string
  error?: string
  helperText?: string
  leftIcon?: React.ReactNode
  rightIcon?: React.ReactNode
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ 
    className, 
    variant, 
    size, 
    type = 'text',
    label,
    error,
    helperText,
    leftIcon,
    rightIcon,
    id,
    ...props 
  }, ref) => {
    const inputId = id || `input-${Math.random().toString(36).substr(2, 9)}`
    const hasError = Boolean(error)
    const currentVariant = hasError ? 'error' : variant

    return (
      <div className="w-full">
        {label && (
          <label 
            htmlFor={inputId}
            className="mb-2 block text-sm font-medium text-gray-700"
          >
            {label}
          </label>
        )}
        
        <div className="relative">
          {leftIcon && (
            <div className="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
              <span className="text-gray-400">{leftIcon}</span>
            </div>
          )}
          
          <input
            type={type}
            className={cn(
              inputVariants({ variant: currentVariant, size }),
              leftIcon && 'pl-10',
              rightIcon && 'pr-10',
              className
            )}
            ref={ref}
            id={inputId}
            aria-invalid={hasError}
            aria-describedby={
              error ? `${inputId}-error` : 
              helperText ? `${inputId}-helper` : 
              undefined
            }
            {...props}
          />
          
          {rightIcon && (
            <div className="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
              <span className="text-gray-400">{rightIcon}</span>
            </div>
          )}
        </div>
        
        {error && (
          <p 
            id={`${inputId}-error`}
            className="mt-1 text-sm text-error-600"
            role="alert"
          >
            {error}
          </p>
        )}
        
        {helperText && !error && (
          <p 
            id={`${inputId}-helper`}
            className="mt-1 text-sm text-gray-500"
          >
            {helperText}
          </p>
        )}
      </div>
    )
  }
)

Input.displayName = 'Input'

export { Input, inputVariants }
```

**Card Component (src/components/ui/Card.tsx):**
```typescript
import React from 'react'
import { cva, type VariantProps } from 'class-variance-authority'
import { cn } from '@/utils/design-system'

const cardVariants = cva(
  'rounded-lg border bg-white text-gray-950 shadow-sm',
  {
    variants: {
      variant: {
        default: 'border-gray-200',
        elevated: 'border-gray-200 shadow-medium',
        outlined: 'border-2 border-gray-300',
      },
      padding: {
        none: '',
        sm: 'p-4',
        md: 'p-6',
        lg: 'p-8',
      },
    },
    defaultVariants: {
      variant: 'default',
      padding: 'md',
    },
  }
)

export interface CardProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof cardVariants> {}

const Card = React.forwardRef<HTMLDivElement, CardProps>(
  ({ className, variant, padding, ...props }, ref) => (
    <div
      ref={ref}
      className={cn(cardVariants({ variant, padding, className }))}
      {...props}
    />
  )
)

const CardHeader = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('flex flex-col space-y-1.5 p-6', className)}
    {...props}
  />
))

const CardTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h3
    ref={ref}
    className={cn(
      'text-2xl font-semibold leading-none tracking-tight',
      className
    )}
    {...props}
  />
))

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p
    ref={ref}
    className={cn('text-sm text-gray-500', className)}
    {...props}
  />
))

const CardContent = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />
))

const CardFooter = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn('flex items-center p-6 pt-0', className)}
    {...props}
  />
))

Card.displayName = 'Card'
CardHeader.displayName = 'CardHeader'
CardTitle.displayName = 'CardTitle'
CardDescription.displayName = 'CardDescription'
CardContent.displayName = 'CardContent'
CardFooter.displayName = 'CardFooter'

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardDescription,
  CardContent,
  cardVariants,
}
```

**Loading Components (src/components/ui/Loading.tsx):**
```typescript
import React from 'react'
import { cn } from '@/utils/design-system'

interface SpinnerProps {
  size?: 'sm' | 'md' | 'lg'
  className?: string
}

export const Spinner: React.FC<SpinnerProps> = ({ 
  size = 'md', 
  className 
}) => {
  const sizeClasses = {
    sm: 'h-4 w-4',
    md: 'h-6 w-6',
    lg: 'h-8 w-8',
  }

  return (
    <svg
      className={cn(
        'animate-spin text-current',
        sizeClasses[size],
        className
      )}
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        className="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        strokeWidth="4"
      />
      <path
        className="opacity-75"
        fill="currentColor"
        d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      />
    </svg>
  )
}

interface SkeletonProps {
  className?: string
  lines?: number
  avatar?: boolean
}

export const Skeleton: React.FC<SkeletonProps> = ({ 
  className, 
  lines = 1,
  avatar = false 
}) => {
  return (
    <div className={cn('animate-pulse', className)}>
      {avatar && (
        <div className="mb-4 h-12 w-12 rounded-full bg-gray-200" />
      )}
      
      {Array.from({ length: lines }).map((_, index) => (
        <div
          key={index}
          className={cn(
            'h-4 bg-gray-200 rounded',
            index < lines - 1 && 'mb-2',
            index === lines - 1 && lines > 1 && 'w-3/4'
          )}
        />
      ))}
    </div>
  )
}

interface LoadingStateProps {
  title?: string
  description?: string
  size?: 'sm' | 'md' | 'lg'
}

export const LoadingState: React.FC<LoadingStateProps> = ({
  title = 'Loading...',
  description,
  size = 'md'
}) => {
  return (
    <div className="flex flex-col items-center justify-center p-8 text-center">
      <Spinner size={size} className="mb-4 text-primary-600" />
      <h3 className="text-lg font-medium text-gray-900">{title}</h3>
      {description && (
        <p className="mt-2 text-sm text-gray-500">{description}</p>
      )}
    </div>
  )
}

interface EmptyStateProps {
  title: string
  description?: string
  icon?: React.ReactNode
  action?: React.ReactNode
}

export const EmptyState: React.FC<EmptyStateProps> = ({
  title,
  description,
  icon,
  action
}) => {
  return (
    <div className="flex flex-col items-center justify-center p-8 text-center">
      {icon && (
        <div className="mb-4 text-gray-400">
          {icon}
        </div>
      )}
      <h3 className="text-lg font-medium text-gray-900">{title}</h3>
      {description && (
        <p className="mt-2 text-sm text-gray-500 max-w-sm">{description}</p>
      )}
      {action && (
        <div className="mt-6">
          {action}
        </div>
      )}
    </div>
  )
}
```

**Deliverables:**
- [ ] Complete set of base UI components (Button, Input, Card, etc.)
- [ ] Consistent variant system using class-variance-authority
- [ ] Loading states and skeleton components
- [ ] Accessibility features built-in
- [ ] TypeScript support with proper prop types

### Task 3: State Management & Data Fetching

#### 3.1 Zustand Store Setup

**Auth Store (src/stores/auth.ts):**
```typescript
import { create } from 'zustand'
import { persist, createJSONStorage } from 'zustand/middleware'
import { immer } from 'zustand/middleware/immer'

export interface User {
  id: string
  email: string
  createdAt: string
  lastLogin?: string
  preferences: Record<string, unknown>
  privacySettings: Record<string, unknown>
}

export interface AuthTokens {
  accessToken: string
  refreshToken: string
  expiresIn: number
  tokenType: string
}

interface AuthState {
  // State
  user: User | null
  tokens: AuthTokens | null
  isAuthenticated: boolean
  isLoading: boolean
  error: string | null
  
  // Actions
  setUser: (user: User) => void
  setTokens: (tokens: AuthTokens) => void
  setLoading: (loading: boolean) => void
  setError: (error: string | null) => void
  login: (email: string, password: string) => Promise<void>
  logout: () => void
  refreshTokens: () => Promise<boolean>
  clearError: () => void
}

export const useAuthStore = create<AuthState>()(
  persist(
    immer((set, get) => ({
      // Initial state
      user: null,
      tokens: null,
      isAuthenticated: false,
      isLoading: false,
      error: null,
      
      // Actions
      setUser: (user) => set((state) => {
        state.user = user
        state.isAuthenticated = true
      }),
      
      setTokens: (tokens) => set((state) => {
        state.tokens = tokens
      }),
      
      setLoading: (loading) => set((state) => {
        state.isLoading = loading
      }),
      
      setError: (error) => set((state) => {
        state.error = error
      }),
      
      login: async (email, password) => {
        set((state) => {
          state.isLoading = true
          state.error = null
        })
        
        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password }),
          })
          
          if (!response.ok) {
            const errorData = await response.json()
            throw new Error(errorData.message || 'Login failed')
          }
          
          const data = await response.json()
          
          set((state) => {
            state.tokens = {
              accessToken: data.access_token,
              refreshToken: data.refresh_token,
              expiresIn: data.expires_in,
              tokenType: data.token_type,
            }
            state.isLoading = false
          })
          
          // Fetch user profile
          const profileResponse = await fetch('/api/auth/profile', {
            headers: {
              'Authorization': `Bearer ${data.access_token}`,
            },
          })
          
          if (profileResponse.ok) {
            const userData = await profileResponse.json()
            set((state) => {
              state.user = userData
              state.isAuthenticated = true
            })
          }
          
        } catch (error) {
          set((state) => {
            state.error = error instanceof Error ? error.message : 'Login failed'
            state.isLoading = false
          })
          throw error
        }
      },
      
      logout: () => set((state) => {
        state.user = null
        state.tokens = null
        state.isAuthenticated = false
        state.error = null
      }),
      
      refreshTokens: async () => {
        const { tokens } = get()
        
        if (!tokens?.refreshToken) {
          return false
        }
        
        try {
          const response = await fetch('/api/auth/refresh', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ refresh_token: tokens.refreshToken }),
          })
          
          if (!response.ok) {
            throw new Error('Token refresh failed')
          }
          
          const data = await response.json()
          
          set((state) => {
            state.tokens = {
              accessToken: data.access_token,
              refreshToken: data.refresh_token,
              expiresIn: data.expires_in,
              tokenType: data.token_type,
            }
          })
          
          return true
          
        } catch (error) {
          // Refresh failed, logout user
          get().logout()
          return false
        }
      },
      
      clearError: () => set((state) => {
        state.error = null
      }),
    })),
    {
      name: 'auth-storage',
      storage: createJSONStorage(() => localStorage),
      partialize: (state) => ({
        user: state.user,
        tokens: state.tokens,
        isAuthenticated: state.isAuthenticated,
      }),
    }
  )
)
```

**UI Store (src/stores/ui.ts):**
```typescript
import { create } from 'zustand'
import { immer } from 'zustand/middleware/immer'

export type Theme = 'light' | 'dark' | 'system'
export type SidebarState = 'open' | 'closed' | 'collapsed'

interface UIState {
  // Theme
  theme: Theme
  
  // Layout
  sidebarState: SidebarState
  isMobile: boolean
  
  // Modals and overlays
  modals: Record<string, boolean>
  
  // Loading states
  globalLoading: boolean
  
  // Notifications
  notifications: Array<{
    id: string
    type: 'success' | 'error' | 'warning' | 'info'
    title: string
    message?: string
    duration?: number
  }>
  
  // Actions
  setTheme: (theme: Theme) => void
  setSidebarState: (state: SidebarState) => void
  setIsMobile: (isMobile: boolean) => void
  openModal: (modalId: string) => void
  closeModal: (modalId: string) => void
  toggleModal: (modalId: string) => void
  setGlobalLoading: (loading: boolean) => void
  addNotification: (notification: Omit<UIState['notifications'][0], 'id'>) => void
  removeNotification: (id: string) => void
  clearNotifications: () => void
}

export const useUIStore = create<UIState>()(
  immer((set, get) => ({
    // Initial state
    theme: 'system',
    sidebarState: 'open',
    isMobile: false,
    modals: {},
    globalLoading: false,
    notifications: [],
    
    // Actions
    setTheme: (theme) => set((state) => {
      state.theme = theme
    }),
    
    setSidebarState: (sidebarState) => set((state) => {
      state.sidebarState = sidebarState
    }),
    
    setIsMobile: (isMobile) => set((state) => {
      state.isMobile = isMobile
      // Auto-collapse sidebar on mobile
      if (isMobile && state.sidebarState === 'open') {
        state.sidebarState = 'collapsed'
      }
    }),
    
    openModal: (modalId) => set((state) => {
      state.modals[modalId] = true
    }),
    
    closeModal: (modalId) => set((state) => {
      state.modals[modalId] = false
    }),
    
    toggleModal: (modalId) => set((state) => {
      state.modals[modalId] = !state.modals[modalId]
    }),
    
    setGlobalLoading: (loading) => set((state) => {
      state.globalLoading = loading
    }),
    
    addNotification: (notification) => set((state) => {
      const id = Math.random().toString(36).substr(2, 9)
      state.notifications.push({
        id,
        duration: 5000,
        ...notification,
      })
    }),
    
    removeNotification: (id) => set((state) => {
      state.notifications = state.notifications.filter(n => n.id !== id)
    }),
    
    clearNotifications: () => set((state) => {
      state.notifications = []
    }),
  }))
)
```

**Deliverables:**
- [ ] Zustand stores with TypeScript support
- [ ] Persistent auth state with localStorage
- [ ] UI state management for theme, layout, modals
- [ ] Immer integration for immutable updates
- [ ] Error handling and loading states

#### 3.2 React Query Setup

**Query Client Configuration (src/services/query-client.ts):**
```typescript
import { QueryClient } from '@tanstack/react-query'
import { useAuthStore } from '@/stores/auth'

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      // Stale time: 5 minutes
      staleTime: 5 * 60 * 1000,
      
      // Cache time: 10 minutes
      cacheTime: 10 * 60 * 1000,
      
      // Retry configuration
      retry: (failureCount, error) => {
        // Don't retry on 4xx errors
        if (error instanceof Error && 'status' in error) {
          const status = (error as any).status
          if (status >= 400 && status < 500) {
            return false
          }
        }
        
        // Retry up to 3 times for other errors
        return failureCount < 3
      },
      
      // Refetch on window focus
      refetchOnWindowFocus: false,
      
      // Error handling
      onError: (error) => {
        console.error('Query error:', error)
        
        // Handle authentication errors
        if (error instanceof Error && 'status' in error) {
          const status = (error as any).status
          if (status === 401) {
            // Token expired, try to refresh
            useAuthStore.getState().refreshTokens()
          }
        }
      },
    },
    
    mutations: {
      // Error handling for mutations
      onError: (error) => {
        console.error('Mutation error:', error)
      },
    },
  },
})
```

**API Service (src/services/api.ts):**
```typescript
import { useAuthStore } from '@/stores/auth'

export class APIError extends Error {
  constructor(
    message: string,
    public status: number,
    public data?: any
  ) {
    super(message)
    this.name = 'APIError'
  }
}

class APIService {
  private baseURL = '/api'
  
  private async request<T>(
    endpoint: string,
    options: RequestInit = {}
  ): Promise<T> {
    const url = `${this.baseURL}${endpoint}`
    
    // Get auth token
    const { tokens } = useAuthStore.getState()
    
    // Default headers
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...options.headers,
    }
    
    // Add auth header if token exists
    if (tokens?.accessToken) {
      headers.Authorization = `Bearer ${tokens.accessToken}`
    }
    
    try {
      const response = await fetch(url, {
        ...options,
        headers,
      })
      
      // Handle non-JSON responses
      const contentType = response.headers.get('content-type')
      const isJSON = contentType?.includes('application/json')
      
      if (!response.ok) {
        let errorMessage = `HTTP ${response.status}: ${response.statusText}`
        let errorData = null
        
        if (isJSON) {
          try {
            errorData = await response.json()
            errorMessage = errorData.message || errorMessage
          } catch {
            // Ignore JSON parsing errors
          }
        }
        
        throw new APIError(errorMessage, response.status, errorData)
      }
      
      // Return response data
      if (isJSON) {
        return await response.json()
      } else {
        return response as unknown as T
      }
      
    } catch (error) {
      if (error instanceof APIError) {
        throw error
      }
      
      // Network or other errors
      throw new APIError(
        error instanceof Error ? error.message : 'Network error',
        0
      )
    }
  }
  
  // HTTP methods
  async get<T>(endpoint: string, params?: Record<string, string>): Promise<T> {
    const url = params 
      ? `${endpoint}?${new URLSearchParams(params)}`
      : endpoint
      
    return this.request<T>(url, { method: 'GET' })
  }
  
  async post<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: 'POST',
      body: data ? JSON.stringify(data) : undefined,
    })
  }
  
  async put<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: 'PUT',
      body: data ? JSON.stringify(data) : undefined,
    })
  }
  
  async patch<T>(endpoint: string, data?: any): Promise<T> {
    return this.request<T>(endpoint, {
      method: 'PATCH',
      body: data ? JSON.stringify(data) : undefined,
    })
  }
  
  async delete<T>(endpoint: string): Promise<T> {
    return this.request<T>(endpoint, { method: 'DELETE' })
  }
  
  // File upload
  async upload<T>(endpoint: string, file: File, data?: Record<string, string>): Promise<T> {
    const formData = new FormData()
    formData.append('file', file)
    
    if (data) {
      Object.entries(data).forEach(([key, value]) => {
        formData.append(key, value)
      })
    }
    
    // Get auth token
    const { tokens } = useAuthStore.getState()
    
    const headers: HeadersInit = {}
    if (tokens?.accessToken) {
      headers.Authorization = `Bearer ${tokens.accessToken}`
    }
    
    const response = await fetch(`${this.baseURL}${endpoint}`, {
      method: 'POST',
      headers,
      body: formData,
    })
    
    if (!response.ok) {
      const errorData = await response.json().catch(() => null)
      throw new APIError(
        errorData?.message || `HTTP ${response.status}: ${response.statusText}`,
        response.status,
        errorData
      )
    }
    
    return await response.json()
  }
}

export const api = new APIService()
```

**Memory Queries (src/services/queries/memories.ts):**
```typescript
import { useQuery, useMutation, useQueryClient, useInfiniteQuery } from '@tanstack/react-query'
import { api } from '@/services/api'

// Types
export interface Memory {
  id: string
  userId: string
  title: string
  description?: string
  contentType: string
  timestamp: string
  aiSummary?: string
  aiTags?: string[]
  sentimentScore?: number
  latitude?: number
  longitude?: number
  locationName?: string
  createdAt: string
  updatedAt: string
  mediaFiles: MediaFile[]
  people: Person[]
}

export interface MediaFile {
  id: string
  fileType: string
  filePath: string
  thumbnailPath?: string
  fileSize?: number
  dimensions?: { width: number; height: number }
}

export interface Person {
  id: string
  name: string
  relationshipType?: string
}

export interface MemorySearchParams {
  query?: string
  contentTypes?: string[]
  startDate?: string
  endDate?: string
  hasMedia?: boolean
  people?: string[]
  page?: number
  size?: number
}

export interface PaginatedResponse<T> {
  data: T[]
  page: number
  size: number
  total: number
  pages: number
  hasNext: boolean
  hasPrev: boolean
}

// Query keys
export const memoryKeys = {
  all: ['memories'] as const,
  lists: () => [...memoryKeys.all, 'list'] as const,
  list: (params: MemorySearchParams) => [...memoryKeys.lists(), params] as const,
  details: () => [...memoryKeys.all, 'detail'] as const,
  detail: (id: string) => [...memoryKeys.details(), id] as const,
  search: (query: string) => [...memoryKeys.all, 'search', query] as const,
  stats: () => [...memoryKeys.all, 'stats'] as const,
}

// Hooks
export function useMemories(params: MemorySearchParams = {}) {
  return useQuery({
    queryKey: memoryKeys.list(params),
    queryFn: () => api.get<PaginatedResponse<Memory>>('/v1/memories', params),
    keepPreviousData: true,
  })
}

export function useInfiniteMemories(params: MemorySearchParams = {}) {
  return useInfiniteQuery({
    queryKey: memoryKeys.list(params),
    queryFn: ({ pageParam = 1 }) =>
      api.get<PaginatedResponse<Memory>>('/v1/memories', {
        ...params,
        page: pageParam.toString(),
      }),
    getNextPageParam: (lastPage) =>
      lastPage.hasNext ? lastPage.page + 1 : undefined,
    keepPreviousData: true,
  })
}

export function useMemory(id: string) {
  return useQuery({
    queryKey: memoryKeys.detail(id),
    queryFn: () => api.get<Memory>(`/v1/memories/${id}`),
    enabled: !!id,
  })
}

export function useSearchMemories(query: string, enabled = true) {
  return useQuery({
    queryKey: memoryKeys.search(query),
    queryFn: () =>
      api.post<PaginatedResponse<Memory>>('/v1/memories/search', { query }),
    enabled: enabled && query.length > 0,
    staleTime: 30 * 1000, // 30 seconds
  })
}

export function useMemoryStats() {
  return useQuery({
    queryKey: memoryKeys.stats(),
    queryFn: () => api.get('/v1/memories/statistics/overview'),
    staleTime: 5 * 60 * 1000, // 5 minutes
  })
}

// Mutations
export function useUpdateMemory() {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: Partial<Memory> }) =>
      api.put<Memory>(`/v1/memories/${id}`, data),
    onSuccess: (updatedMemory) => {
      // Update the memory in cache
      queryClient.setQueryData(
        memoryKeys.detail(updatedMemory.id),
        updatedMemory
      )
      
      // Invalidate memory lists
      queryClient.invalidateQueries({ queryKey: memoryKeys.lists() })
    },
  })
}

export function useDeleteMemory() {
  const queryClient = useQueryClient()
  
  return useMutation({
    mutationFn: (id: string) => api.delete(`/v1/memories/${id}`),
    onSuccess: (_, deletedId) => {
      // Remove from cache
      queryClient.removeQueries({ queryKey: memoryKeys.detail(deletedId) })
      
      // Invalidate memory lists
      queryClient.invalidateQueries({ queryKey: memoryKeys.lists() })
      
      // Invalidate stats
      queryClient.invalidateQueries({ queryKey: memoryKeys.stats() })
    },
  })
}
```

**Deliverables:**
- [ ] React Query configuration with error handling
- [ ] API service with authentication integration
- [ ] Memory queries with pagination and infinite scroll
- [ ] Mutation hooks with optimistic updates
- [ ] Query key management and cache invalidation

---

## Final Deliverables Summary

### 1. Project Setup & Build Configuration
- [ ] Vite configuration with optimization and code splitting
- [ ] TypeScript setup with strict type checking
- [ ] ESLint and Prettier configuration
- [ ] Project structure following best practices
- [ ] Development and build scripts

### 2. Design System & UI Components
- [ ] Comprehensive Tailwind CSS configuration
- [ ] Design system utilities and constants
- [ ] Base UI components (Button, Input, Card, Loading states)
- [ ] Component variant system with class-variance-authority
- [ ] Responsive design utilities and animation presets

### 3. State Management & Data Fetching
- [ ] Zustand stores for auth and UI state
- [ ] React Query setup with error handling
- [ ] API service with authentication integration
- [ ] Query hooks with pagination and caching
- [ ] Mutation hooks with optimistic updates

### 4. Performance & Accessibility
- [ ] Code splitting and lazy loading
- [ ] Bundle size optimization
- [ ] WCAG 2.1 AA compliance
- [ ] Keyboard navigation support
- [ ] Performance monitoring and budgets

### 5. Development Experience
- [ ] Hot reload and fast development server
- [ ] TypeScript integration with strict checking
- [ ] Automated testing setup
- [ ] Code quality tools and pre-commit hooks
- [ ] Bundle analysis and performance monitoring

### 6. Foundation for Features
- [ ] Authentication flow ready
- [ ] Routing structure prepared
- [ ] Error handling and loading states
- [ ] Responsive layout components
- [ ] Theme and UI state management

---

## Success Validation

To validate successful completion of this epic:

1. **Development Experience**: Hot reload < 1s, no TypeScript errors
2. **Performance**: Lighthouse score > 90, bundle < 500KB gzipped
3. **Accessibility**: WCAG 2.1 AA compliance, keyboard navigation
4. **Responsive Design**: Works on mobile, tablet, and desktop
5. **Type Safety**: 100% TypeScript coverage, no `any` types
6. **Testing**: >80% test coverage for components
7. **Error Handling**: Graceful error recovery and user feedback
8. **State Management**: Proper data flow and cache management

---

**Epic Owner**: Frontend Lead + UI Developer  
**Stakeholders**: Design Team, Backend Team, QA Team  
**Dependencies**: 1.1.3 Core API Framework  
**Risk Level**: Medium (complexity of modern frontend stack, performance requirements)